# civic_ai.py
import re
import datetime
from civic_db import init_db, add_complaint, list_complaints

init_db()  # create database when starting


def detect_category(text):
    text = text.lower()
    if "родрогрпНрогрпАро░рпН" in text:
        return "родрогрпНрогрпАро░рпН"
    elif "роЪро╛ро▓рпИ" in text or "роХрпБро┤ро┐" in text:
        return "роЪро╛ро▓рпИ"
    elif "рооро┐ройрпНроЪро╛ро░роорпН" in text or "ро╡ро┐ро│роХрпНроХрпБ" in text:
        return "рооро┐ройрпНроЪро╛ро░роорпН"
    elif "роХрпБрокрпНрокрпИ" in text or "роЕро┤рпБроХрпНроХрпБ" in text:
        return "роХрпБрокрпНрокрпИ"
    else:
        return "рооро▒рпНро▒ро╡рпИ"

def civic_bot():
    print("ЁЯПЫя╕П родрооро┐ро┤рпН роХрпБроЯро┐роороХрпНроХро│рпН роЙродро╡ро┐ропро╛ро│ро░рпН")
    print("тАФ роироХро░ро╛роЯрпНроЪро┐ / родрогрпНрогрпАро░рпН / рооро┐ройрпНроЪро╛ро░роорпН / роЪро╛ро▓рпИ / роХрпБрокрпНрокрпИ рокро┐ро░роЪрпНроЪройрпИроХро│рпН тАФ")
    print("рокрпБроХро╛ро░рпН роЕро│ро┐роХрпНроХ родрпКроЯроЩрпНроХрпБроЩрпНроХро│рпН (ро╡рпЖро│ро┐ропрпЗро▒ 'exit' роОрой роОро┤рпБродрпБроЩрпНроХро│рпН)\n")

    while True:
        user_input = input("роирпАроЩрпНроХро│рпН: ").strip()
        if user_input.lower() == "exit":
            print("ЁЯСЛ роиройрпНро▒ро┐! роЙроЩрпНроХро│рпН роиро╛ро│рпН роиройрпНро▒ро╛роХ роЕроорпИропроЯрпНроЯрпБроорпН.")
            break

        if not user_input:
            print("тЪая╕П родропро╡рпБроЪрпЖропрпНродрпБ роТро░рпБ рокрпБроХро╛ро░рпН роЙро│рпНро│ро┐роЯрпБроЩрпНроХро│рпН.\n")
            continue

        category = detect_category(user_input)
        date = datetime.datetime.now().strftime("%Y-%m-%d %H:%M")
        complaint_id = f"CMP{int(datetime.datetime.now().timestamp())}"

        print("\nтЬЕ роЙроЩрпНроХро│рпН рокрпБроХро╛ро░рпН рокродро┐ро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯродрпБ!")
        print(f"ЁЯЖФ рокрпБроХро╛ро░рпН роОрогрпН: {complaint_id}")
        print(f"ЁЯУЕ родрпЗродро┐: {date}")
        print(f"ЁЯУВ рокро┐ро░ро┐ро╡рпБ: {category}")
        print(f"ЁЯУЭ ро╡ро┐ро╡ро░роорпН: {user_input}\n")
        print("ЁЯФН роЕродро┐роХро╛ро░ро┐роХро│рпН ро╡ро┐ро░рпИро╡ро┐ро▓рпН роироЯро╡роЯро┐роХрпНроХрпИ роОроЯрпБрокрпНрокро╛ро░рпНроХро│рпН.\n")

if __name__ == "__main__":
    civic_bot()
